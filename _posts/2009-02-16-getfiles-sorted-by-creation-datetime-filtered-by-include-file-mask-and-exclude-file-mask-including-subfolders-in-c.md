---
ID: 259
post_title: 'GetFiles, sorted by Creation DateTime, filtered by include file mask and exclude file mask, including subfolders in C#'
author: Roel van Lisdonk
post_excerpt: ""
layout: post
permalink: >
  https://www.roelvanlisdonk.nl/2009/02/16/getfiles-sorted-by-creation-datetime-filtered-by-include-file-mask-and-exclude-file-mask-including-subfolders-in-c/
published: true
post_date: 2009-02-16 15:28:40
---
<p>The "GetFiles" function, returns all files in the given folder, including subfolders, that match the "includeMask". The result is sorted by the file CreationTime. The function excludes all files that match the "excludeMask"</p> <p><strong></strong>&nbsp;</p> <p><strong>To call the function:</strong></p><pre class="code"><span style="color:#2b91af;">List</span>&lt;<span style="color:#2b91af;">FileInfo</span>&gt; files = <span style="color:#2b91af;">FileSystemHelper</span>.GetFiles(<span style="color:#a31515;">@"C:\Windows"</span>,<span style="color:#a31515;">"*.*"</span>, <span style="color:#a31515;">"*.exe"</span>, <span style="color:#2b91af;">SortOrder</span>.Ascending, <span style="color:#2b91af;">SearchOption</span>.AllDirectories);</pre><a href="http://11011.net/software/vspaste"></a>
<p>&nbsp;</p>
<p><strong>The function:<br /></strong><span style="color:gray;">/// &lt;summary&gt;<br />/// </span><span style="color:green;">Get files in a folder sorted by creation datetime and filtered by include mask and exclude mask<br /></span><span style="color:gray;">/// &lt;/summary&gt;<br />/// &lt;param name="folder"&gt;</span><span style="color:green;">The folder containing the files</span><span style="color:gray;">&lt;/param&gt;<br />/// &lt;param name="includeMask"&gt;</span><span style="color:green;">Include files that meet the given mask</span><span style="color:gray;">&lt;/param&gt;<br />/// &lt;param name="excludeMask"&gt;</span><span style="color:green;">Exclude files that meet the given mask</span><span style="color:gray;">&lt;/param&gt;<br />/// &lt;param name="sortOrder"&gt;</span><span style="color:green;">Sort order, ascending or descending</span><span style="color:gray;">&lt;/param&gt;<br />/// &lt;param name="searchOption"&gt;</span><span style="color:green;">AllDirectories or TopDirectoryOnly</span><span style="color:gray;">&lt;/param&gt;<br />/// &lt;returns&gt;&lt;/returns&gt;<br /></span><span style="color:blue;">public static</span><span style="color:#2b91af;">List</span>&lt;<span style="color:#2b91af;">FileInfo</span>&gt; GetFiles(<span style="color:blue;">string </span>folder, <span style="color:blue;">string </span>includeMask, <span style="color:blue;">string </span>excludeMask, <span style="color:#2b91af;">SortOrder </span>sortOrder, <span style="color:#2b91af;">SearchOption </span>searchOption)<br />{<br />&nbsp;&nbsp;&nbsp; <span style="color:#2b91af;">DirectoryInfo </span>folderDirectoryInfo = <span style="color:blue;">new</span><span style="color:#2b91af;">DirectoryInfo</span>(folder);<br />&nbsp;&nbsp;&nbsp; <span style="color:#2b91af;">List</span>&lt;<span style="color:#2b91af;">FileInfo</span>&gt; files = <span style="color:blue;">new</span><span style="color:#2b91af;">List</span>&lt;<span style="color:#2b91af;">FileInfo</span>&gt;(folderDirectoryInfo.GetFiles(includeMask, searchOption));<br />&nbsp;&nbsp;&nbsp; <br />&nbsp;&nbsp;&nbsp; <span style="color:blue;">string</span>excludeMaskRegEx = <span style="color:#2b91af;">FileSystemHelper</span>.WildcardToRegex(excludeMask);<br /><br />&nbsp;&nbsp;&nbsp; <span style="color:green;">// exclude files<br />&nbsp;&nbsp; </span>files = (<span style="color:blue;">from</span>file <span style="color:blue;">in</span>files<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color:blue;">where</span>!<span style="color:#2b91af;">Regex</span>.IsMatch(file.Name, excludeMaskRegEx) <br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color:blue;">select</span>file).ToList&lt;<span style="color:#2b91af;">FileInfo</span>&gt;();<br /><br /><br />&nbsp;&nbsp;&nbsp; <span style="color:blue;">if</span>(files.Count &gt; 0)<br />&nbsp;&nbsp;&nbsp; {<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color:blue;">switch</span>(sortOrder)<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color:blue;">case</span><span style="color:#2b91af;">SortOrder</span>.Ascending:<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color:green;">// Sort files oldest first<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>files.Sort(<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color:blue;">delegate</span>(<span style="color:#2b91af;">FileInfo </span>firstFile, <span style="color:#2b91af;">FileInfo </span>secondFile)<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color:blue;">return</span>firstFile.CreationTime.CompareTo(secondFile.CreationTime);<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; );<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color:blue;">break</span>;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color:blue;">case</span><span style="color:#2b91af;">SortOrder</span>.Descending:<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color:green;">// Sort files newest first<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>files.Sort(<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color:blue;">delegate</span>(<span style="color:#2b91af;">FileInfo </span>firstFile, <span style="color:#2b91af;">FileInfo </span>secondFile)<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color:blue;">return</span>secondFile.CreationTime.CompareTo(firstFile.CreationTime);<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; );<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color:blue;">break</span>;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<br /><br />&nbsp;&nbsp;&nbsp; }<br /><br />&nbsp;&nbsp;&nbsp; <span style="color:blue;">return</span>files;<br />}</p><a href="http://11011.net/software/vspaste"></a>
<p>&nbsp;</p><pre class="code"><span style="color:gray;">/// &lt;summary&gt;
/// </span><span style="color:green;">Convert a wildcard mask to regular expression
</span><span style="color:gray;">/// &lt;/summary&gt;
/// &lt;param name="pattern"&gt;</span><span style="color:green;">wildcard string</span><span style="color:gray;">&lt;/param&gt;
/// &lt;returns&gt;</span><span style="color:green;">Regular expression string</span><span style="color:gray;">&lt;/returns&gt;
</span><span style="color:blue;">public static string </span>WildcardToRegex(<span style="color:blue;">string </span>pattern)
{
    <span style="color:blue;">return string</span>.Format(<span style="color:#a31515;">"^{0}$"</span>, <span style="color:#2b91af;">Regex</span>.Escape(pattern).Replace(<span style="color:#a31515;">"\\*"</span>, <span style="color:#a31515;">".*"</span>).Replace(<span style="color:#a31515;">"\\?"</span>, <span style="color:#a31515;">"."</span>));
}</pre><a href="http://11011.net/software/vspaste"></a><pre class="code"><span style="color:blue;">public enum </span><span style="color:#2b91af;">SortOrder
</span>{
        Ascending,
        Descending
}</pre><a href="http://11011.net/software/vspaste"></a>