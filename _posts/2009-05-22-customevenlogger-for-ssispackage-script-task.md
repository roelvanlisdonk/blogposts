---
ID: 456
post_title: >
  CustomEvenLogger for SSISPackage Script
  Task
author: Roel van Lisdonk
post_excerpt: ""
layout: post
permalink: >
  https://www.roelvanlisdonk.nl/2009/05/22/customevenlogger-for-ssispackage-script-task/
published: true
post_date: 2009-05-22 15:12:26
---
<p>Imports System    <br />Imports System.Diagnostics </p>  <p>' This class is used for logging to a customeventlog from a SSISPackage Script Taks    <br />' By using a ExceptionCategories enum, we can guide the developers to use structured error messages.     <br />'     <br />' [10-JUL-2008 RVL] Created     <br />'     <br />' [RFC] Get standardMessage from *.resx file.     <br />Public Class Logger     <br />&#160;&#160;&#160; Dim eventLogName As String = &quot;C221A814-192E.SSISPackages.Package1&quot;     <br />&#160;&#160;&#160; Dim eventLogSource As String = &quot;C221A814-192E.SSISPackages.Package1&quot;     <br />&#160;&#160;&#160; Dim eventLogMachineName As String = &quot;.&quot;     <br />&#160;&#160;&#160; Enum ExceptionCategories     <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160; UnExpectedError     <br />&#160;&#160;&#160; End Enum </p>  <p>&#160;&#160;&#160; 'Log exception to EventLog and Console    <br />&#160;&#160;&#160; Public Sub LogExceptionEvent(ByVal message As String, ByVal ex As Exception, ByVal exceptionCategory As ExceptionCategories)     <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160; If String.IsNullOrEmpty(message) Then     <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; message = &quot;&quot;     <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160; End If </p>  <p>&#160;&#160;&#160;&#160;&#160;&#160;&#160; If Not EventLog.SourceExists(eventLogSource, eventLogMachineName) Then    <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; EventLog.CreateEventSource(eventLogSource, eventLogName, eventLogMachineName)     <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160; End If </p>  <p>&#160;&#160;&#160;&#160;&#160;&#160;&#160; Dim standardMessage As String    <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160; Dim eventId As Integer     <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160; Dim eventSubCategory As Short = 1     <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160; Select Case exceptionCategory     <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; Case ExceptionCategories.UnExpectedError     <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; standardMessage = &quot;Unknow error occured&quot;     <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; eventId = 1     <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; Case Else     <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; standardMessage = &quot;Unknow Enum ExceptionCategories, developer forgot the implement a case statement for this exception category&quot;     <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; eventId = 1000     <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160; End Select </p>  <p>&#160;&#160;&#160;&#160;&#160;&#160;&#160; Dim exceptionMessage As String = String.Empty    <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160; Dim exceptionStackTrace As String = String.Empty     <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160; Dim innerExceptionMessage As String = String.Empty     <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160; Dim innerExceptionStackTrace As String = String.Empty </p>  <p>&#160;&#160;&#160;&#160;&#160;&#160;&#160; If Not ex Is Nothing Then    <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; If Not String.IsNullOrEmpty(ex.Message) Then     <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; exceptionMessage = ex.Message     <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; End If     <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; If Not String.IsNullOrEmpty(ex.StackTrace) Then     <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; exceptionStackTrace = ex.StackTrace     <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; End If     <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; If Not ex.InnerException Is Nothing Then     <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; If Not String.IsNullOrEmpty(ex.InnerException.Message) Then     <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; innerExceptionMessage = ex.InnerException.Message     <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; End If     <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; If Not String.IsNullOrEmpty(ex.InnerException.StackTrace) Then     <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; innerExceptionStackTrace = ex.InnerException.StackTrace     <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; End If     <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; End If     <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160; End If </p>  <p>&#160;&#160;&#160;&#160;&#160;&#160;&#160; Dim el As New EventLog(eventLogName, eventLogMachineName, eventLogSource)    <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160; el.WriteEntry(&quot;Standard Message [&quot; &amp; standardMessage &amp; &quot;] &quot; _     <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160; &amp; &quot;ExtendedMessage [&quot; &amp; message + &quot;] &quot; _     <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160; &amp; &quot;] ExceptionMessage [&quot; &amp; exceptionMessage + &quot;] &quot; _     <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160; &amp; &quot;] ExceptionStackTrace [&quot; &amp; exceptionStackTrace + &quot;] &quot; _     <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160; &amp; &quot;] InnerExceptionMessage [&quot; &amp; innerExceptionMessage + &quot;] &quot; _     <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160; &amp; &quot;] InnerExceptionStackTrace [&quot; &amp; innerExceptionStackTrace + &quot;] &quot; _     <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160; , EventLogEntryType.Error, eventId, eventSubCategory)     <br />&#160;&#160;&#160; End Sub     <br />End Class</p>