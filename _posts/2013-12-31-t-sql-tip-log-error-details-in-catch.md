---
ID: 3613
post_title: 'T-SQL tip: log error details in catch'
author: Roel van Lisdonk
post_excerpt: ""
layout: post
permalink: >
  https://www.roelvanlisdonk.nl/2013/12/31/t-sql-tip-log-error-details-in-catch/
published: true
post_date: 2013-12-31 10:14:27
---
<p>If you want to log detailed information on an error in a catch block, you can use the following code:</p>  <p>&#160;</p>  <pre class="code"><span style="background: white; color: blue">BEGIN CATCH
        declare </span><span style="background: white; color: black">@Message </span><span style="background: white; color: blue">varchar</span><span style="background: white; color: gray">(</span><span style="background: white; color: black">2048</span><span style="background: white; color: gray">) = 
        </span><span style="background: white; color: red">'&lt;&lt; Your custom error text here. &gt;&gt;' </span><span style="background: white; color: gray">+ 
        </span><span style="background: white; color: red">'Number: ' </span><span style="background: white; color: gray">+ </span><span style="background: white; color: magenta">cast</span><span style="background: white; color: gray">(</span><span style="background: white; color: magenta">isnull</span><span style="background: white; color: gray">(</span><span style="background: white; color: magenta">error_number</span><span style="background: white; color: gray">(), </span><span style="background: white; color: red">''</span><span style="background: white; color: gray">) </span><span style="background: white; color: blue">as varchar</span><span style="background: white; color: gray">(</span><span style="background: white; color: black">50</span><span style="background: white; color: gray">)) + </span><span style="background: white; color: red">' ' </span><span style="background: white; color: gray">+
        </span><span style="background: white; color: red">'Severity: ' </span><span style="background: white; color: gray">+ </span><span style="background: white; color: magenta">cast</span><span style="background: white; color: gray">(</span><span style="background: white; color: magenta">isnull</span><span style="background: white; color: gray">(</span><span style="background: white; color: magenta">error_severity</span><span style="background: white; color: gray">(), </span><span style="background: white; color: red">''</span><span style="background: white; color: gray">) </span><span style="background: white; color: blue">as varchar</span><span style="background: white; color: gray">(</span><span style="background: white; color: black">50</span><span style="background: white; color: gray">)) + </span><span style="background: white; color: red">' ' </span><span style="background: white; color: gray">+
        </span><span style="background: white; color: red">'State: ' </span><span style="background: white; color: gray">+ </span><span style="background: white; color: magenta">cast</span><span style="background: white; color: gray">(</span><span style="background: white; color: magenta">isnull</span><span style="background: white; color: gray">(</span><span style="background: white; color: magenta">error_state</span><span style="background: white; color: gray">(), </span><span style="background: white; color: red">''</span><span style="background: white; color: gray">) </span><span style="background: white; color: blue">as varchar</span><span style="background: white; color: gray">(</span><span style="background: white; color: black">100</span><span style="background: white; color: gray">)) + </span><span style="background: white; color: red">' ' </span><span style="background: white; color: gray">+
        </span><span style="background: white; color: red">'Procedure: ' </span><span style="background: white; color: gray">+ </span><span style="background: white; color: magenta">cast</span><span style="background: white; color: gray">(</span><span style="background: white; color: magenta">isnull</span><span style="background: white; color: gray">(</span><span style="background: white; color: magenta">error_procedure</span><span style="background: white; color: gray">(), </span><span style="background: white; color: red">''</span><span style="background: white; color: gray">) </span><span style="background: white; color: blue">as varchar</span><span style="background: white; color: gray">(</span><span style="background: white; color: black">1024</span><span style="background: white; color: gray">)) + </span><span style="background: white; color: red">' ' </span><span style="background: white; color: gray">+
        </span><span style="background: white; color: red">'Line: ' </span><span style="background: white; color: gray">+ </span><span style="background: white; color: magenta">cast</span><span style="background: white; color: gray">(</span><span style="background: white; color: magenta">isnull</span><span style="background: white; color: gray">(</span><span style="background: white; color: magenta">error_line</span><span style="background: white; color: gray">(), </span><span style="background: white; color: red">''</span><span style="background: white; color: gray">) </span><span style="background: white; color: blue">as varchar</span><span style="background: white; color: gray">(</span><span style="background: white; color: black">10</span><span style="background: white; color: gray">)) + </span><span style="background: white; color: red">' ' </span><span style="background: white; color: gray">+
        </span><span style="background: white; color: red">'Message: ' </span><span style="background: white; color: gray">+ </span><span style="background: white; color: magenta">cast</span><span style="background: white; color: gray">(</span><span style="background: white; color: magenta">isnull</span><span style="background: white; color: gray">(</span><span style="background: white; color: magenta">error_message</span><span style="background: white; color: gray">(), </span><span style="background: white; color: red">''</span><span style="background: white; color: gray">) </span><span style="background: white; color: blue">as varchar</span><span style="background: white; color: gray">(</span><span style="background: white; color: black">1024</span><span style="background: white; color: gray">)) + </span><span style="background: white; color: red">' '

        </span><span style="background: white; color: blue">ROLLBACK TRANSACTION    

        RAISERROR </span><span style="background: white; color: gray">(</span><span style="background: white; color: black">@Message</span><span style="background: white; color: gray">, </span><span style="background: white; color: black">16</span><span style="background: white; color: gray">, </span><span style="background: white; color: black">1</span><span style="background: white; color: gray">)
        
<blockquote style="margin-right: 0px" dir="ltr"><p></span><span style="background: white; color: gray">&#160;</p></blockquote>
    </span><span style="background: white; color: blue">END CATCH</span></pre>