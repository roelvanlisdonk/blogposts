---
ID: 806
post_title: 'How to detect unattended installation (msiexec /quit or /qn) in you&#8217;re Custom Action with C#'
author: Roel van Lisdonk
post_excerpt: ""
layout: post
permalink: >
  https://www.roelvanlisdonk.nl/2009/11/13/how-to-detect-unattended-installation-msiexec-quit-or-qn-in-youre-custom-action-with-c/
published: true
post_date: 2009-11-13 11:42:30
---
<p><strong><font size="4">Solution</font></strong>    <br />Set UILevel property in CustomActionData, enter: /UILevel=&quot;[UILevel]&quot;    <br />    <br /><a href="http://www.roelvanlisdonk.nl/wp-content/uploads/2009/11/image.png"><img style="border-bottom: 0px; border-left: 0px; display: inline; border-top: 0px; border-right: 0px" title="image" border="0" alt="image" src="http://www.roelvanlisdonk.nl/wp-content/uploads/2009/11/image_thumb.png" width="546" height="199" /></a>     <br /></p>  <p><strong><font size="4">Description       <br /></font></strong>A msi package can be started with different user interface types. For instance, a *.msi package started with msiexec /quit /i Example.msi, will have an UILevel = 2, but the same *.msi package started with msiexec /i Example.msi will have an UILevel = 5, see <a title="http://msdn.microsoft.com/en-us/library/aa369487(VS.85).aspx" href="http://msdn.microsoft.com/en-us/library/aa369487(VS.85).aspx">http://msdn.microsoft.com/en-us/library/aa369487(VS.85).aspx</a></p> <form id="aspnetForm" method="post" name="aspnetForm" action="http://msdn.microsoft.com/aa369487(VS.85).aspx">   <div id="contents">     <div id="ctl00_raRight" class="rightSection">       <div class="ContentArea">         <div class="topic">           <table><tbody>               <tr>                 <th>User interface level</th>                  <th>Value</th>                  <th>Description</th>               </tr>                <tr>                 <td>msiUILevelNoChange</td>                  <td>0</td>                  <td>Does not change UI level.</td>               </tr>                <tr>                 <td>msiUILevelDefault</td>                  <td>1</td>                  <td>Uses default UI level.</td>               </tr>                <tr>                 <td>msiUILevelNone</td>                  <td>2</td>                  <td>Silent installation.</td>               </tr>                <tr>                 <td>msiUILevelBasic</td>                  <td>3</td>                  <td>Simple progress and error handling.</td>               </tr>                <tr>                 <td>msiUILevelReduced</td>                  <td>4</td>                  <td>Authored UI and wizard dialog boxes suppressed.</td>               </tr>                <tr>                 <td>msiUILevelFull</td>                  <td>5</td>                  <td>Authored UI with wizards, progress, and errors.</td>               </tr>                <tr>                 <td>msiUILevelHideCancel</td>                  <td>32</td>                  <td>If combined with the msiUILevelBasic value, the installer shows progress dialog boxes but does not display a <strong>Cancel</strong> button on the dialog box to prevent users from canceling the installation.</td>               </tr>                <tr>                 <td>msiUILevelProgressOnly</td>                  <td>64</td>                  <td>If combined with the msiUILevelBasic value, the installer displays progress dialog boxes but does not display any modal dialog boxes or error dialog boxes.</td>               </tr>                <tr>                 <td>msiUILevelEndDialog</td>                  <td>128</td>                  <td>If combined with any above value, the installer displays a modal dialog box at the end of a successful installation or if there has been an error. No dialog box is displayed if the user cancels.</td>               </tr>             </tbody></table>         </div>          <p class="topic">           <br />If you want to detect de UILevel of you’re executed msi package, during the execution of the msi package in a custom action follow the steps:            <br /></p>          <div class="topic">           <ul>             <li>At a System.Configuration.Install.Installer to you’re project</li>              <li><a href="http://www.roelvanlisdonk.nl/wp-content/uploads/2009/11/image1.png"><img style="border-bottom: 0px; border-left: 0px; display: inline; border-top: 0px; border-right: 0px" title="image" border="0" alt="image" src="http://www.roelvanlisdonk.nl/wp-content/uploads/2009/11/image_thumb1.png" width="397" height="244" /></a> </li>              <li>Make sure the System.Configuration.Install.Installer has the attribute [<span style="color: #2b91af">RunInstaller</span>(<span style="color: blue">true</span>)] set</li>              <li>Make sure the System.Configuration.Install.Installer has event handling wired up for the events you whish to handle (in this case I want to run code “AfterInstall” and “BeforeUninstall”</li>              <li><a href="http://www.roelvanlisdonk.nl/wp-content/uploads/2009/11/image2.png"><img style="border-bottom: 0px; border-left: 0px; display: inline; border-top: 0px; border-right: 0px" title="image" border="0" alt="image" src="http://www.roelvanlisdonk.nl/wp-content/uploads/2009/11/image_thumb2.png" width="302" height="317" /></a> </li>              <li>At a setup project to you’re solution</li>              <li>At the output and content files of you’re project to the setup project</li>              <li><a href="http://www.roelvanlisdonk.nl/wp-content/uploads/2009/11/image3.png"><img style="border-bottom: 0px; border-left: 0px; display: inline; border-top: 0px; border-right: 0px" title="image" border="0" alt="image" src="http://www.roelvanlisdonk.nl/wp-content/uploads/2009/11/image_thumb3.png" width="284" height="336" /></a> </li>              <li>Add custom actions (so the System.Configuration.Install.Installer events are fired)</li>              <li><a href="http://www.roelvanlisdonk.nl/wp-content/uploads/2009/11/image4.png"><img style="border-bottom: 0px; border-left: 0px; display: inline; border-top: 0px; border-right: 0px" title="image" border="0" alt="image" src="http://www.roelvanlisdonk.nl/wp-content/uploads/2009/11/image_thumb4.png" width="244" height="40" /></a> </li>              <li><a href="http://www.roelvanlisdonk.nl/wp-content/uploads/2009/11/image5.png"><img style="border-bottom: 0px; border-left: 0px; display: inline; border-top: 0px; border-right: 0px" title="image" border="0" alt="image" src="http://www.roelvanlisdonk.nl/wp-content/uploads/2009/11/image_thumb5.png" width="244" height="125" /></a> </li>              <li>Click on the custom actions and set the UILevel to /UILevel=&quot;[UILevel]&quot; in the CustomActionData on the property page</li>              <li><a href="http://www.roelvanlisdonk.nl/wp-content/uploads/2009/11/image.png"><img style="border-bottom: 0px; border-left: 0px; display: inline; border-top: 0px; border-right: 0px" title="image" border="0" alt="image" src="http://www.roelvanlisdonk.nl/wp-content/uploads/2009/11/image_thumb.png" width="546" height="199" /></a></li>              <li>In you’re “AfterInstall” event handler you can know access user interface type of the executed msi package, via this.Context.Parameters[“UILevel”] </li>              <li>Msi parameters are case sensitive so use “UILevel”</li>              <pre class="code"><span style="color: blue">private void </span>AfterInstallation(<span style="color: blue">object </span>sender, <span style="color: #2b91af">InstallEventArgs </span>e)
{

<span style="color: blue">#if </span>DEBUG
            <span style="color: green">// Break when in debug modus
            </span><span style="color: #2b91af">Debugger</span>.Break();
<span style="color: blue">#endif

            string </span>uiLevel = <span style="color: blue">this</span>.Context.Parameters[<span style="color: #a31515">&quot;UILevel&quot;</span>];</pre>

            <pre class="code">}</pre>
            <a href="http://11011.net/software/vspaste"></a></ul>
        </div>

        <p></p>

        <ul><a href="http://11011.net/software/vspaste"></a></ul>
      </div>
    </div>
  </div>
</form>