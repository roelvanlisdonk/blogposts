---
ID: 4915
post_title: >
  Communicate between controllers in
  Angular by using a simple pubsub service
  in TypeScript.
author: Roel van Lisdonk
post_excerpt: ""
layout: post
permalink: >
  https://www.roelvanlisdonk.nl/2016/06/16/communicate-between-controllers-in-angular-by-using-a-simple-pubsub-service-in-typescript/
published: true
post_date: 2016-06-16 15:47:31
---
<p>&#160;</p>  <p>I created a really simple angular PubSubService in TypeScript, to allow communication between controllers or directives or services.</p>  <p>&#160;</p>  <p>In the example below, controller 1, fires an event and controller 2 reacts to the firing of the event.</p>  <p><font face="Courier New"></font></p>  <p>&#160;</p>  <p>&#160;</p>  <p><font size="2" face="Courier New">module dev {     <br />&#160;&#160;&#160; &quot;use strict&quot;;</font></p>  <p><font size="2" face="Courier New"></font></p>  <p><font size="2" face="Courier New">&#160;&#160;&#160; </font><font face="Courier New">var appModule = angular.module(&quot;myApp&quot;, []);</font></p>  <p><font size="2" face="Courier New">&#160;&#160;&#160; </font><font face="Courier New">appModule.controller(&quot;MyController1&quot;, [&quot;$scope&quot;, &quot;pubSubService&quot;, ($scope, pubSubService)</font></p>  <p><font size="2" face="Courier New">&#160;&#160;&#160; </font><font face="Courier New">=&gt; new dev.MyController1($scope, pubSubService)]);</font></p>  <p><font size="2" face="Courier New">&#160;&#160;&#160; </font><font face="Courier New">appModule.controller(&quot;MyController2&quot;, [&quot;$scope&quot;, &quot;pubSubService&quot;, ($scope, pubSubService)     <br />&#160;&#160;&#160; =&gt; new dev.MyController2($scope, pubSubService)]);</font></p>  <p><font face="Courier New"></font>&#160;<font size="2" face="Courier New">&#160;&#160;&#160; </font></p>  <p><font face="Courier New"></font>&#160;</p>  <p><font size="2" face="Courier New">&#160;&#160;&#160; </font><font face="Courier New">export class MyController1 {     <br />&#160;&#160;&#160; <font size="2" face="Courier New">&#160;&#160;&#160; </font>constructor(public $scope: ng.IScope, public pubSubService: PubSubService) {      <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160; <font size="2" face="Courier New">&#160;&#160;&#160; </font>// Fire an an event      <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160; <font size="2" face="Courier New">&#160;&#160;&#160; </font>pubSubService.publish(&quot;my-custom-event&quot;, &quot;some publisher data&quot;);      <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160; <font size="2" face="Courier New">&#160;&#160;&#160; </font>}      <br /><font size="2" face="Courier New">&#160;&#160;&#160; </font>}</font></p>  <p>   <br /><font size="2" face="Courier New">&#160;&#160;&#160; </font><font face="Courier New">export class MyController2 {     <br />&#160;&#160;&#160; <font size="2" face="Courier New">&#160;&#160;&#160; </font>constructor(public $scope: ng.IScope, public pubSubService: PubSubService) {      <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160; <font size="2" face="Courier New">&#160;&#160;&#160; </font>this.handleMyCustomEvent = this.handleMyCustomEvent.bind(this);</font></p>  <p><font face="Courier New">&#160;&#160;&#160;&#160;&#160;&#160;&#160; <font size="2" face="Courier New">&#160;&#160;&#160; </font>// Subscribe to be notified, when &quot;my-custom-event&quot; is fired.      <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160; <font size="2" face="Courier New">&#160;&#160;&#160; </font>pubSubService.subscribe(&quot;my-custom-event&quot;, this.handleMyCustomEvent);      <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160; }      <br />&#160;&#160;&#160; <br />&#160;&#160;&#160; <font size="2" face="Courier New">&#160;&#160;&#160; </font>handleMyCustomEvent(data: any) {      <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160; // Do something, when an event is fired from MyController1.      <br />&#160;&#160;&#160; <font size="2" face="Courier New">&#160;&#160;&#160; </font>}      <br /><font size="2" face="Courier New">&#160;&#160;&#160; </font>}</font></p>  <p>&#160;</p>  <p><font size="2" face="Courier New"></font></p>  <p><font size="2" face="Courier New"></font></p>  <p><font size="2" face="Courier New">&#160;&#160;&#160; /**     <br />&#160;&#160;&#160;&#160; * This service can be used to share data between controllers by using a pub sub mechanism.      <br />&#160;&#160;&#160;&#160; */      <br />&#160;&#160;&#160; export class PubSubService {      <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160; private nextListenerIndex: number;      <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160; private listeners: Array&lt;IListener&gt;;</font></p>  <p><font size="2" face="Courier New">&#160;&#160;&#160;&#160;&#160;&#160;&#160; constructor() {     <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; this.listeners = [];      <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; this.nextListenerIndex = 0; // The first subscription will be located at index 0;</font></p>  <p><font size="2" face="Courier New">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; this.publish = this.publish.bind(this);     <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; this.subscribe = this.subscribe.bind(this);      <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; this.unsubscribe = this.unsubscribe.bind(this);      <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160; }</font></p>  <p><font size="2" face="Courier New">&#160;&#160;&#160;&#160;&#160;&#160;&#160; /**     <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; * Publish an event.      <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; * All subscribers will be notified.      <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; * @param name, is the name of the event and is case insensitive.      <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; */      <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160; publish(name: string, data?: any) {      <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; for (var i = 0, length = this.listeners.length; i &lt; length; i++) {      <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; const listener = this.listeners[i];      <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; if (listener &amp;&amp; listener.name.toLowerCase() === name.toLowerCase()) {      <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; listener.handler.call(null, data, listener.subData);      <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; }      <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; }      <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160; }</font></p>  <p><font size="2" face="Courier New">&#160;&#160;&#160;&#160;&#160;&#160;&#160; /**     <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; * Subscribe to be notified, when an event is published.      <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; * @param name, is the name of the event and is case insensitive.      <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; * @returns A token, that can be used to unsubscribe.      <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; */      <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160; subscribe(name: string, handler: (data?: any, subData?: any) =&gt; void, data?: any): number {      <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; var token = this.nextListenerIndex;      <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; this.listeners[token] = {      <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; handler: handler,      <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; name: name,      <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; subData: data      <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; };      <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; this.nextListenerIndex += 1;</font></p>  <p><font size="2" face="Courier New">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; return token;     <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160; }</font></p>  <p><font size="2" face="Courier New">&#160;&#160;&#160;&#160;&#160;&#160;&#160; /**     <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; * Remove the event listener subscription.      <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; * @param token received on subscribing to an event listener.      <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; */      <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160; unsubscribe(token: number) {</font></p>  <p><font size="2" face="Courier New">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; // This will create holes in the array, but for now we do not care.     <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; this.listeners[token] = null;&#160; <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160; }      <br />&#160;&#160;&#160; }</font></p>  <p><font size="2" face="Courier New">&#160;&#160;&#160; export interface IListener {     <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160; // This function will be called when an event is published.       <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160; // Data is the data from the publisher, subData is the data from the subscriber.      <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160; handler: (data?: any, subData?: any) =&gt; void;       <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160; name: string;      <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160; subData?: any; // Data from the subscriber.      <br />&#160;&#160;&#160; }</font></p>  <p><font size="2" face="Courier New">&#160;&#160;&#160; angular.service(&quot;pubSubService&quot;, () =&gt; new PubSubService());     <br />}</font></p>