---
ID: 4335
post_title: 'Fix: Visual Studio 2013 / 2014&ndash;SQL Server 2014 &#8211; The term &lsquo;Invoke-Sqlcmd&rsquo; is not recognized as the name of a cmdlet'
author: Roel van Lisdonk
post_excerpt: ""
layout: post
permalink: >
  https://www.roelvanlisdonk.nl/2015/05/06/fix-visual-studio-2013-2014sql-server-2014-the-term-invoke-sqlcmd-is-not-recognized-as-the-name-of-a-cmdlet/
published: true
post_date: 2015-05-06 13:16:54
---
<p>&#160;</p>  <p align="left"><strong>Note</strong></p>  <p align="left">When you want to run / edit / debug PowerShell scripts inside Visual Studio 2013 / 2015 you will have to install the “PowerShell Tools for Visual Studio” Visual Studio extension found at: <a title="https://visualstudiogallery.msdn.microsoft.com/c9eb3ba8-0c59-4944-9a62-6eee37294597" href="https://visualstudiogallery.msdn.microsoft.com/c9eb3ba8-0c59-4944-9a62-6eee37294597">https://visualstudiogallery.msdn.microsoft.com/c9eb3ba8-0c59-4944-9a62-6eee37294597</a></p>  <p>&#160;</p>  <p>I wanted to run and debug a PowerShell script inside Visual Studio 2013 / 2015, on a machine that only had SQL Server 2014 installed as database server. This threw an exception: The term ‘Invoke-Sqlcmd’ is not recognized as the name of a cmdlet <a title="http://blog.sqlauthority.com/2014/11/23/sql-server-fix-the-term-invoke-sqlcmd-is-not-recognized-as-the-name-of-a-cmdlet/" href="http://blog.sqlauthority.com/2014/11/23/sql-server-fix-the-term-invoke-sqlcmd-is-not-recognized-as-the-name-of-a-cmdlet/">http://blog.sqlauthority.com/2014/11/23/sql-server-fix-the-term-invoke-sqlcmd-is-not-recognized-as-the-name-of-a-cmdlet/</a></p>  <p>&#160;</p>  <p>Turns out you have to update the PowerShell “PSModulePath”, so it can find the PowerShell modules containing the SQL Server 2014 cmdlets.</p>  <p>&#160;</p>  <p>Temp fix:</p>  <p><a title="http://stackoverflow.com/questions/29562742/invoke-sqlcmd-failing-after-automated-sql-install-with-powershell" href="http://stackoverflow.com/questions/29562742/invoke-sqlcmd-failing-after-automated-sql-install-with-powershell">http://stackoverflow.com/questions/29562742/invoke-sqlcmd-failing-after-automated-sql-install-with-powershell</a></p>  <p>   <br />Existing Powershell session isn't aware about Sql's modules that were just installed. Take a look at environment variable $env:PSModulePath. Compare new shell's variable to existing and you should see a missing path like ...\Microsoft SQL Server\110\Tools\PowerShell\Modules\.    <br />For a work-around, modify the path to include module dir. Like so,</p>  <p>$env:PSModulePath += &quot;;C:\Program Files (x86)\Microsoft SQL Server\120\Tools\PowerShell\Modules&quot;</p>  <p>&#160;</p>  <p>If you want to persist this extra “Module load path”, you have to change the registry:</p>  <p><a title="http://tomtalks.uk/2013/06/powershell-add-a-persistent-module-path-to-envpsmodulepath/" href="http://tomtalks.uk/2013/06/powershell-add-a-persistent-module-path-to-envpsmodulepath/">http://tomtalks.uk/2013/06/powershell-add-a-persistent-module-path-to-envpsmodulepath/</a></p>  <p>&#160;</p>  <p><a href="http://www.roelvanlisdonk.nl/wp-content/uploads/2015/05/image.png" rel="lightbox"><img title="image" style="border-top: 0px; border-right: 0px; background-image: none; border-bottom: 0px; padding-top: 0px; padding-left: 0px; border-left: 0px; margin: 0px 5px; display: inline; padding-right: 0px" border="0" alt="image" src="http://www.roelvanlisdonk.nl/wp-content/uploads/2015/05/image_thumb.png" width="580" height="366" /></a></p>  <p>&#160;</p>  <p>Now I can run and debug the following PowerShell script inside Visual Studio 2013 / 2015:</p>  <pre class="code"><span style="background: white; color: #006400"># This sccript requires the system to allow running powershell scripts, when not allowed the following code can be used to allow running powershell scripts.
# Set-ExecutionPolicy RemoteSigned

# The following import statement enables the SQL Server PowerShell cmdlets, like &quot;Invoke-Sqlcmd&quot;.
</span><span style="background: white; color: blue">Import-Module </span><span style="background: white; color: #8a2be2">SqlPs

</span><span style="background: white; color: #ff4500">$serverInstance </span><span style="background: white; color: #a9a9a9">= </span><span style="background: white; color: darkred">&quot;(localdb)\v11.0&quot;
</span><span style="background: white; color: #ff4500">$database </span><span style="background: white; color: #a9a9a9">= </span><span style="background: white; color: darkred">&quot;App&quot;


</span><span style="background: white; color: #00008b">function </span><span style="background: white; color: #8a2be2">ExecuteSqlFile </span><span style="background: white; color: black">{
    </span><span style="background: white; color: #a9a9a9">[</span><span style="background: white; color: teal">string</span><span style="background: white; color: #a9a9a9">]</span><span style="background: white; color: #ff4500">$file </span><span style="background: white; color: #a9a9a9">= </span><span style="background: white; color: #ff4500">$args</span><span style="background: white; color: #a9a9a9">[</span><span style="background: white; color: purple">0</span><span style="background: white; color: #a9a9a9">]
    </span><span style="background: white; color: blue">Invoke-Sqlcmd </span><span style="background: white; color: navy">-ServerInstance </span><span style="background: white; color: #ff4500">$serverInstance </span><span style="background: white; color: navy">-Database </span><span style="background: white; color: #ff4500">$database </span><span style="background: white; color: navy">-InputFile </span><span style="background: white; color: #ff4500">$file
</span><span style="background: white; color: black">}

</span><span style="background: white; color: blue">ExecuteSqlFile</span><span style="background: white; color: black">(</span><span style="background: white; color: darkred">'C:\Temp\test.sql'</span><span style="background: white; color: black">)</span></pre>